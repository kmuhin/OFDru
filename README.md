# Модуль для работы с api оператора фискальных данных [OFD.ru](https://ofd.ru/razrabotchikam)

## Использование

    import ofdru_class.py
    
### Для работы сначала нужно получить ключ с помощью регистрационных данных от личного кабинета ofd.ru:
    
    key = OfdKey()
    key.update(Login, Password)

### Заполняю данные по кассе:

    data_kkt = {"FNumber": "серийный номер ФН",
                "INN": "инн организации",
                "KKTNumber": "серийный номер ККТ",
                "KKTRegNumber": "регистрационный номер ККТ в ФНС"
                }

### Создаю объект кассы. Передаю ключ и данные кассы:

    kkt = OfdKkt(key, data_kkt)

### Информация о кассе:

    kkt.get_info()

### Детальные чеки. По умолчанию за текущий день, если не указан период:

    kkt.get_receipts_short()

### Чеки. По умолчанию за текущий день, если не указан период:

    kkt.get_receipts()

### Детальные чеки по номеру смены:

    kkt.get_receipts_shift(5)

### z-отчеты. По умолчанию за текущий день, если не указан период:

    kkt.get_z_reports()

### Детальный чек по Id ФД:

    kkt.get_receipt_by_id(RawId)

### Детальный чек по номеру смены и номеру ФД в смене:

    kkt.get_receipt_by_shift(5, 1)

## Дополнительно

### Период указывается двумя датами date1, date2:

    kkt.get_receipts(date1='2021-02-11T10:23:00', date2='2021-02-12T16:23:00')

### Формат даты в запросах:
%Y-%m-%dT%H:%M:%S
Время в дате, как оказалось, не влияет на выборку.

### Ключ(токен авторизации)
Выдается на сутки. 
Кэшируется в файл 'authtoken.json' по умолчанию. Меняется через атрибут OfdKey.file_key.

* OfdKey.update(Login, Password) - полный цикл получения ключа. Сначала пытается считать ключ из файла. Eсли нет ключа или просрочен, обновляет c ofd.ru. Сохраняет в файл.

* OfdKey.get_key_from_file() - считать ключ из файла.
* OfdKey.save_key_to_file() - сохранить ключ в файл.
* OfdKey.get_key_from_url(Login, Password) - получить ключ с ofd.ru.

* OfdKey.key - строка с ключем.
* OfdKey.ExpirationDateUtc - строка со сроком жизни ключа в формате UTC (так как передает офд).
* OfdKey.expired - True если ключ просрочен или False.

